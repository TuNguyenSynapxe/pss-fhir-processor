@model MOH.HealthierSG.Plugins.PSS.FhirProcessor.WebApp.Models.PlaygroundResultViewModel
@{
    ViewBag.Title = "Processing Result";
}

<!DOCTYPE html>
<html>
<head>
    <title>@ViewBag.Title</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .valid { background-color: #d4edda; }
        .invalid { background-color: #f8d7da; }
        .error { color: red; margin: 5px 0; }
        .log { font-family: monospace; font-size: 12px; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Processing Result</h1>
        
        <div class="section @(Model.ProcessResult.Validation.IsValid ? "valid" : "invalid")">
            <h2>Validation: @(Model.ProcessResult.Validation.IsValid ? "VALID" : "INVALID")</h2>
            
            @if (!Model.ProcessResult.Validation.IsValid && Model.ProcessResult.Validation.Errors != null)
            {
                <h3>Errors (@Model.ProcessResult.Validation.Errors.Count):</h3>
                foreach (var error in Model.ProcessResult.Validation.Errors)
                {
                    <div class="error">
                        <strong>[@error.Code]</strong> @error.Message
                        <br/>
                        <small>Path: @error.FieldPath | Scope: @error.Scope</small>
                    </div>
                }
            }
        </div>
        
        @if (Model.ProcessResult.Flatten != null)
        {
            <div class="section">
                <h2>Extraction Result</h2>
                
                <h3>Event Data:</h3>
                <pre>@Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.ProcessResult.Flatten.Event, Newtonsoft.Json.Formatting.Indented))</pre>
                
                <h3>Participant Data:</h3>
                <pre>@Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.ProcessResult.Flatten.Participant, Newtonsoft.Json.Formatting.Indented))</pre>
                
                <h3>Hearing Screening:</h3>
                <pre>@Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.ProcessResult.Flatten.HearingRaw, Newtonsoft.Json.Formatting.Indented))</pre>
                
                <h3>Oral Screening:</h3>
                <pre>@Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.ProcessResult.Flatten.OralRaw, Newtonsoft.Json.Formatting.Indented))</pre>
                
                <h3>Vision Screening:</h3>
                <pre>@Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.ProcessResult.Flatten.VisionRaw, Newtonsoft.Json.Formatting.Indented))</pre>
            </div>
        }
        
        <div class="section">
            <h2>Logs</h2>
            @if (Model.ProcessResult.Logs != null)
            {
                foreach (var log in Model.ProcessResult.Logs)
                {
                    <div class="log">@log</div>
                }
            }
        </div>
        
        <div>
            <a href="@Url.Action("Index", "Playground")">Back to Playground</a>
        </div>
    </div>
</body>
</html>
